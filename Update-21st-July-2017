

1.The script main.py processes the Apache Log File to convert it to JSON format.
2.Usage: python main.py -f accesslog1. Here, accesslog1 is the log-file to be processed.
Scikit Learn accepts data in json format for processing.


JSON Output on processing this:
{"1": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "http://adnansiddiqi.com", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "24"}, "2": {"STATUS": "200", "REQUEST": "GET / HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "28527"}, "3": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "1.202.218.21", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:39:31 -0600", "USERAGENT": "Mozilla/5.0 (compatible; JikeSpider; +http://shoulu.jike.com/spider.html)", "IDENTITY": "-", "SIZE": "24"}, "4": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "24"}, "5": {"STATUS": "200", "REQUEST": "GET / HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "28527"}, "6": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "1.202.218.21", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:39:31 -0600", "USERAGENT": "Mozilla/5.0 (compatible; JikeSpider; +http://shoulu.jike.com/spider.html)", "IDENTITY": "-", "SIZE": "24"}, "7": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "24"}, "8": {"STATUS": "200", "REQUEST": "GET / HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "28527"}, "9": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "1.202.218.21", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:39:31 -0600", "USERAGENT": "Mozilla/5.0 (compatible; JikeSpider; +http://shoulu.jike.com/spider.html)", "IDENTITY": "-", "SIZE": "24"}, "10": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "24"}, "11": {"STATUS": "200", "REQUEST": "GET / HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "28527"}, "12": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "1.202.218.21", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:39:31 -0600", "USERAGENT": "Mozilla/5.0 (compatible; JikeSpider; +http://shoulu.jike.com/spider.html)", "IDENTITY": "-", "SIZE": "24"}, "13": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "24"}, "14": {"STATUS": "200", "REQUEST": "GET / HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "28527"}, "15": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "1.202.218.21", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:39:31 -0600", "USERAGENT": "Mozilla/5.0 (compatible; JikeSpider; +http://shoulu.jike.com/spider.html)", "IDENTITY": "-", "SIZE": "24"}, "16": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "24"}, "17": {"STATUS": "200", "REQUEST": "GET / HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "28527"}, "18": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "1.202.218.21", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:39:31 -0600", "USERAGENT": "Mozilla/5.0 (compatible; JikeSpider; +http://shoulu.jike.com/spider.html)", "IDENTITY": "-", "SIZE": "24"}, "19": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "24"}, "20": {"STATUS": "200", "REQUEST": "GET / HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "28527"}, "21": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "1.202.218.21", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:39:31 -0600", "USERAGENT": "Mozilla/5.0 (compatible; JikeSpider; +http://shoulu.jike.com/spider.html)", "IDENTITY": "-", "SIZE": "24"}, "22": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "24"}, "23": {"STATUS": "200", "REQUEST": "GET / HTTP/1.1", "HOST": "65.55.213.73", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:16:27 -0600", "USERAGENT": "msnbot/2.0b (+http://search.msn.com/msnbot.htm)", "IDENTITY": "-", "SIZE": "28527"}, "24": {"STATUS": "200", "REQUEST": "GET /robots.txt HTTP/1.1", "HOST": "1.202.218.21", "REFERER": "-", "USER": "-", "TIME": "16/Nov/2012:06:39:31 -0600", "USERAGENT": "Mozilla/5.0 (compatible; JikeSpider; +http://shoulu.jike.com/spider.html)", "IDENTITY": "-", "SIZE": "24"}}

Now, we have 9 features available. 


Currently, trying to implement feature extraction along the lines of:
http://scikit-learn.org/stable/modules/feature_extraction.html
using DictVectorizer and Feature-Hashing
Detect an attack for invalid authentication by looking at three numeric features at first:
1. Status (Generally 401)
2. Host (Should be same for all such requests within a small time frame)
3. Size of response received (Shouldn't vary much for consequent request).

Once this is implemented, we can look at non-numeric features like POST without the corresponding GET.

Read through the following links:
http://www.markhneedham.com/blog/2015/03/02/python-scikit-learn-training-a-classifier-with-non-numeric-features/
https://github.com/saromanov/scikit-json/blob/master/scikit_json/scikit_json.py
http://scikit-learn.org/stable/modules/feature_extraction.html
https://stackoverflow.com/questions/15164506/how-to-define-json-data-as-x-and-y-sklearn-decision-tree-arrays
https://github.com/kadnan/logs2json (Reference for json conversion)
